/* eslint-disable @typescript-eslint/no-unsafe-call */
/* eslint-disable @typescript-eslint/no-unsafe-assignment */
import { APIGatewayProxyEventHeaders } from 'aws-lambda';
import UnauthorizedError from './unauthorized-error';

const { authenticate } = jest.requireActual('./authenticate');

describe('execute authenticated callback', () => {
  const authorizationToken =
    'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImFHbGZWMTI3MHRfWVlNa0o4cWZqTiJ9.eyJpc3MiOiJodHRwczovL3Rlc3QtZWRpdG9udGhlc3BvdC5hdS5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjIzOWNhYWMzMDBjOTQwMDY5YzM0YjFiIiwiYXVkIjpbInB1YmxpYy13ZWItYXBpIiwiaHR0cHM6Ly90ZXN0LWVkaXRvbnRoZXNwb3QuYXUuYXV0aDAuY29tL3VzZXJpbmZvIl0sImlhdCI6MTY0ODExMTI2NSwiZXhwIjoxNjQ4MTk3NjY1LCJhenAiOiJYMVZVUDVEbVVzSHRBR3BKS0V6SnI4V1VwY09wSzMwdSIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwifQ.C6gFXvrk9s0YKwugfavnw84QSpIbMKGQUztD8-jrtRw2XGOEORr12wxN1OAWG98SfmokPQdHt8bXynw-3QNHo5hoowtSjMxW460JlGHiKD-CgS3z6qNdZSm3YJ7CXii6m5VT6o2rVzcZUyGy2KZwg-49FKE5DrC-DP8xSpTb4VRZPZKGYKSdq67k1wNZx_HzFP0ljy6n_Ts-yxGxXMbJLA2igXBaOVtocmzn42DOdLVCQnNjd3peObNLxtHpKCjoC4i1A9g7Jzf1x3jzsJdStg4awjQAozlFeCqee-E7Q3dvOzxb5725_53nzYwn6-soGM-WI_wxMN4ZVk9o7g-KyA';
  const identityToken =
    'Token eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImFHbGZWMTI3MHRfWVlNa0o4cWZqTiJ9.eyJuaWNrbmFtZSI6ImZvdW5kZXJzIiwibmFtZSI6ImZvdW5kZXJzQGVkaXRvbnRoZXNwb3QuY29tIiwicGljdHVyZSI6Imh0dHBzOi8vcy5ncmF2YXRhci5jb20vYXZhdGFyL2EyNjBkNWQwNGExOGE5MjhjZDhhMjc1MzE2M2VkNGRjP3M9NDgwJnI9cGcmZD1odHRwcyUzQSUyRiUyRmNkbi5hdXRoMC5jb20lMkZhdmF0YXJzJTJGZm8ucG5nIiwidXBkYXRlZF9hdCI6IjIwMjItMDMtMjRUMDg6NDA6NTEuMDg2WiIsImVtYWlsIjoiZm91bmRlcnNAZWRpdG9udGhlc3BvdC5jb20iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImlzcyI6Imh0dHBzOi8vdGVzdC1lZGl0b250aGVzcG90LmF1LmF1dGgwLmNvbS8iLCJzdWIiOiJhdXRoMHw2MjM5Y2FhYzMwMGM5NDAwNjljMzRiMWIiLCJhdWQiOiJYMVZVUDVEbVVzSHRBR3BKS0V6SnI4V1VwY09wSzMwdSIsImlhdCI6MTY0ODExMTI2NSwiZXhwIjoxNjQ4MTExMzI1LCJub25jZSI6IkxsUmpjVXg0Y0VaYVpFdEtkbjVZVkRSQ2RFUXlSRWRITW5wR2FEbFNkaTAwZUVka1R6TXRPV2xTY3c9PSJ9.1ar5vItoFhD46SNjui2YfxY801EDaCKMGXWYXFpRtjlsz5Tn2nvyhahH4J5XBrH8UhhlS5MW8WrFqSYviMyuA3eQXX3vj5Ubfrq5BNHdUhm68ra1aC-TuyoBmzQWca5Yvea4A6BAPoqvqdwjtOmDJ4DQXPxt6lNY-_d4hvIc73gFCdZhfIbQnSF_kssy2KmEEONz9YQ_j0OMATHhOBwuqhfIwEqxERbXnXfMyrWZtpzzIFy2lAG7Kyf1slSuSfQKy0Zby4ZYg0aU2S1AbgmpAgiwZhrzFiZCZ6LfyJ8Ha2T3h-PqubI1a3L8wq_ew3dn0J_R-LhU7s7H12bL6awfSw';

  it('throws unauthorized exception for expired tokens', () => {
    const headers: APIGatewayProxyEventHeaders = {};
    headers['Authorization'] = authorizationToken;
    headers['identity'] = identityToken;

    expect(authenticate(headers)).rejects.toThrowError(new UnauthorizedError('jwt expired'));
  });
});
